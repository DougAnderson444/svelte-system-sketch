import{a2 as G}from"./vendor-12395ee4.js";function O(i=16){return G("abcdefghijklmnopqrztuvwxyz1234567890",i)()}function P(i){return{name:"Name",id:O(),x:10,y:10,style:{backgroundColor:"#fee9004b",width:120,height:120,left:10,top:10},props:[],children:[]}}class U{constructor({container:a}){this.container=a,this.vtm=this.createMatrix(),this.x=0,this.y=0,this.captureScale=1,this.stop=!1}clamp(a,e,t,h){let m=(this.container.clientWidth-h.width)/2,g=(this.container.clientHeight-h.height)/2,x=m*a+h.width*a-this.container.clientWidth,d=Math.min(this.vtm.e*1,0),_=Math.min(this.vtm.f*1,0),X=e>0?d:-(m*a),W=e>0?d:-x,M=this.vtm.e;M=Math.max(W,this.vtm.e),M=Math.min(X,M);let T=g*a+h.height*a-this.container.clientHeight,L=t>0?_:-(g*a),E=t>0?_:-T,w=this.vtm.f;w=Math.min(L,w),w=Math.max(w,E),this.vtm=this.createMatrix().translate(M,w).scale(Math.max(this.vtm.a,1))}createMatrix(){return new DOMMatrix}move(a,e,t,h,m){return this.vtm=this.createMatrix().translate(this.x-a,this.y-e).scale(this.vtm.a),this.vtm}scale(a,e,t,h,m,g,x,d,_){return this.vtm=this.createMatrix().translate(t.x,t.y).scale(a,e).translate(-t.x,-t.y).multiply(this.vtm),Math.min(Math.max(1,this.vtm.a),x),this.vtm}}class q{constructor(){this.touchA={clientX:0,clientY:0,t:0,velocity:1},this.touchB={clientX:0,clientY:0,t:0,velocity:1}}down(a,e){this.touchA={clientX:a.clientX,clientY:a.clientY,t:Date.now(),velocity:0},this.touchB={clientX:e.clientX,clientY:e.clientY,t:Date.now(),veloctiy:0}}calc(a,e){var t=a.clientX,h=a.clientY,m=Date.now(),g=t-e.clientX,x=h-e.clientY,d=m-e.t,_=Math.sqrt(g*g+x*x)/d;e.velocity=_,e.clientX=t,e.clientY=h,e.t=m}getVelocity(a,e){return this.calc(a,this.touchA),this.calc(e,this.touchB),this.touchA.velocity+this.touchB.velocity}}function j(i,a,e,t){var h=Math.min(e/i,t/a);return{width:i*h,height:a*h,ratio:h}}function V(i,a){return Math.hypot(i.pageX-a.pageX,i.pageY-a.pageY)}let R=!1,p={initX:0,initY:0,newX:0,newY:0},f,r,k=new q,$={time:0,x:0,y:0};const I=(i,a={})=>{var N;let e={scaling:!1,x1:0,x2:0,y1:0,y2:0,lastHypo:0,originX:0,originY:0,value:((N=a==null?void 0:a.scale)==null?void 0:N.value)||1,max:20},t=i.parentElement||document.body;t.style["touch-action"]="none",t.style["user-select"]="none",t.style.overflow="hidden",t.style.position="relative",i.style["touch-action"]="none",i.style["user-select"]="none",i.style.position="absolute",i.style.height="100%",i.style.width="100%",r=new U({container:t}),g(),i.addEventListener("dragstart",m,{passive:!1}),i.addEventListener("drag",m,{passive:!1}),t.addEventListener("mousedown",z,{passive:!1}),t.addEventListener("touchstart",E,{passive:!1}),t.addEventListener("wheel",L,{passive:!1}),t.addEventListener("dragstart",m,{passive:!1}),t.addEventListener("drag",m,{passive:!1}),window.addEventListener("resize",x);const h=new MutationObserver((n,s)=>{for(const l of n)if(l.type==="attributes"){let c;const o=/(\w+)\(([^)]*)\)/g;for(;c=o.exec(i.style.transform);)c[1]=="scale"&&parseFloat(c[2]).toFixed(2)!=e.value.toFixed(2)&&(e.value=c[2])}});h.observe(i,{attributes:!0,childList:!1,subtree:!1});function m(n){return console.log("Removing drag listener"),!1}function g(){const{offsetWidth:n,offsetHeight:s}=i;f=j(n,s,t.clientWidth,t.clientHeight)}function x(){g(),d(0,0),_(0,0),X()}function d(n,s){p.initX=n,p.initY=s,r.x=r.vtm.e,r.y=r.vtm.f}function _(n,s){if(e.scaling)return;let l=(t.clientWidth-f.width*r.vtm.a)/2,c=(t.clientHeight-f.height*r.vtm.a)/2;p.newX=p.initX-n,p.newY=p.initY-s;const o=r.move(p.newX,p.newY,l,c,f);i.style.transform=`matrix(${o.a},${o.b},${o.c},${o.d},${o.e}, ${o.f})`}function X(){r.x-=p.newX,r.y-=p.newY,e.scaling=!1,e.lastHypo=0}function W(n,s){const l=[Math.min(n.pageX,s.pageX),Math.max(n.pageX,s.pageX)],c=[Math.min(n.pageY,s.pageY),Math.max(n.pageY,s.pageY)],v=(l[1]-l[0])/2+l[0],y=(c[1]-c[0])/2+c[0];e.originX=v,e.originY=y,e.lastHypo=Math.trunc(V(n,s))}function M(n,s){let l=r.vtm.a,c=l>1?l-1:e.max/2.5,o=l>1?-1:1;const v=1+c*o,u=v;let y=(t.clientWidth-f.width*Math.max(v*l,1))/2,D=(t.clientHeight-f.height*Math.max(v*l,1))/2;const F={x:n-t.clientWidth/2-t.offsetLeft,y:s-t.clientHeight/2-t.offsetTop},Y=r.scale(v,u,F,y,D,f,e.max,e.value*v,o);e.value=Y.d,i.style.transform=`translate(${Y.e}px, ${Y.f}px) scale(${Y.a})`}function T(n,s,l){const c=V(n,s);let o=c/e.lastHypo;o=o>=1?1:-1;const v=k.getVelocity(n,s)||1,u=1+.1*v*o,y=u;let D=(t.clientWidth-f.width*r.vtm.a)/2,F=(t.clientHeight-f.height*r.vtm.a)/2;const Y={x:e.originX-t.clientWidth/2-t.offsetLeft,y:e.originY-t.clientHeight/2-t.offsetTop},b=r.scale(u,y,Y,D,F,f,e.max,e.value*u,o);e.value=b.d,e.lastHypo=c,e.scaling=!0,i.style.transform=`translate(${b.e}px, ${b.f}px) scale(${b.a})`}function L(n){n.preventDefault();const s=n.deltaY<0?1:-1,l=1+.1*s,c=l;let o=(t.clientWidth-f.width*r.vtm.a)/2,v=(t.clientHeight-f.height*r.vtm.a)/2;const u={x:n.pageX-t.clientWidth/2-t.offsetLeft,y:n.pageY-t.clientHeight/2-t.offsetTop},y=r.scale(l,c,u,o,v,f,e.max,e.value*l,s);e.value=y.d,i.style.transform=`translate(${y.e}px,${y.f}px) scale(${y.a})`,i.dispatchEvent(new CustomEvent("zoomed",{detail:{style:i.style,scale:e,matrix:r,origin:u}}))}function E(n){R=!0;const s=n.touches.length===2,[l,c]=n.touches;if(e.scaling=s,s)W(l,c),k.down(l,c);else{const{pageX:v,pageY:u}=l;var o=new Date().getTime();o-$.time<250&&Math.hypot($.x-v,$.y-u)<=20?M(v,u):d(v,u),$={time:o,x:v,y:u}}i.removeEventListener("touchmove",w),i.removeEventListener("touchend",H),i.addEventListener("touchmove",w),i.addEventListener("touchend",H)}function w(n){if(e.scaling){const[s,l]=n.touches;T(s,l)}else _(n.touches[0].pageX,n.touches[0].pageY)}function H(n){X(),i.removeEventListener("touchmove",w),i.removeEventListener("touchend",H),i.removeEventListener("touchcancel",H)}function z(n){if(t!==n.target&&i!==n.target)return;const{clientX:s,clientY:l}=n;R||(d(s,l),t.addEventListener("mousemove",S),t.addEventListener("mouseup",C))}function S({clientX:n,clientY:s}){_(n,s)}function C(){t.removeEventListener("mousemove",S),X()}return{update(n){console.log("Directive updated params",{params:n})},destroy(){i.removeEventListener("wheel",L),i.removeEventListener("mousedown",z),i.removeEventListener("touchstart",E),i.removeEventListener("dragstart",m),i.addEventListener("drag",m),window.removeEventListener("resize",x),h.disconnect()}}};new q;export{P as c,I as p,O as s};
